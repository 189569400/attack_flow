# Attack Flow Format

Attack Flow represents the linkage of adversary behavior for a given attack flow .

The type, description, and required attributes of each field are provided in the subsequent sections along with an example.

TODO: Visual for the Attack Flow model / Data Dictionary.

*Entity Diagram for Attack Flow Format*

## TODOs / Open Items
1. Extension point for properties not defined on Actions/Assets

## Data Dictionary

<!--JSON_SCHEMA Generated by `generate_schema_docs.py` at 2021-10-20T14:47:42.108165Z-->
<h3 id="TopLevelMetadata">Top Level Metadata Fields</h3>
<table>
  <tr>
    <th>Name</th>
    <th>Type</th>
    <th>Required</th>
    <th>Description</th>
  </tr>
  <tr>
    <td>type</td>
    <td>string</td>
    <td>Yes</td>
    <td>Indicate whether this is an attack flow or an attack flow pattern</td>
  </tr>
  <tr>
    <td>id</td>
    <td>string (format: uuid)</td>
    <td>Yes</td>
    <td>UUID for this attack flow or pattern.</td>
  </tr>
  <tr>
    <td>created</td>
    <td>string (format: date-time)</td>
    <td>Yes</td>
    <td>Creation time. (RFC-3339 format, e.g. YYYY-MM-DDThh:mm:ssZ)</td>
  </tr>
  <tr>
    <td>author</td>
    <td>string</td>
    <td>No</td>
    <td>The author of the attack flow</td>
  </tr>
  <tr>
    <td>actions</td>
    <td>array of <a href="#actions">actions</a></td>
    <td>Yes</td>
    <td>The list of action nodes in the attack flow</td>
  </tr>
  <tr>
    <td>assets</td>
    <td>array of <a href="#assets">assets</a></td>
    <td>Yes</td>
    <td>The list of asset nodes in the attack flow</td>
  </tr>
  <tr>
    <td>relationships</td>
    <td>array of <a href="#relationships">relationships</a></td>
    <td>Yes</td>
    <td>The list of relationship edges in the attack flow</td>
  </tr>
</table>

<h3 id="actions">Actions Fields</h3>
<table>
  <tr>
    <th>Name</th>
    <th>Type</th>
    <th>Required</th>
    <th>Description</th>
  </tr>
  <tr>
    <td>id</td>
    <td>string (format: uuid)</td>
    <td>Yes</td>
    <td>UUID for this action.</td>
  </tr>
  <tr>
    <td>name</td>
    <td>string</td>
    <td>Yes</td>
    <td>The name of the action. May be an ATT&amp;CK name.</td>
  </tr>
  <tr>
    <td>description</td>
    <td>string</td>
    <td>Yes</td>
    <td>A description of the action.</td>
  </tr>
  <tr>
    <td>timestamp</td>
    <td>string (format: date-time)</td>
    <td>No</td>
    <td>The timestamp when this action was observed. (RFC-3339 format, e.g. YYYY-MM-DDThh:mm:ssZ)</td>
  </tr>
  <tr>
    <td>reference</td>
    <td>string</td>
    <td>No</td>
    <td>A description of the action.</td>
  </tr>
  <tr>
    <td>properties</td>
    <td>array of string</td>
    <td>No</td>
    <td>The list of properties associated with the action.</td>
  </tr>
  <tr>
    <td>succeeded</td>
    <td>string</td>
    <td>No</td>
    <td>TODO</td>
  </tr>
  <tr>
    <td>confidence</td>
    <td>string</td>
    <td>No</td>
    <td>TODO</td>
  </tr>
  <tr>
    <td>state</td>
    <td>string</td>
    <td>No</td>
    <td>TODO</td>
  </tr>
</table>

<h3 id="assets">Assets Fields</h3>
<table>
  <tr>
    <th>Name</th>
    <th>Type</th>
    <th>Required</th>
    <th>Description</th>
  </tr>
  <tr>
    <td>id</td>
    <td>string (format: uuid)</td>
    <td>Yes</td>
    <td>UUID for this asset.</td>
  </tr>
  <tr>
    <td>properties</td>
    <td>array of string</td>
    <td>No</td>
    <td>The list of properties associated with the asset.</td>
  </tr>
</table>

<h3 id="relationships">Relationships Fields</h3>
<table>
  <tr>
    <th>Name</th>
    <th>Type</th>
    <th>Required</th>
    <th>Description</th>
  </tr>
  <tr>
    <td>id</td>
    <td>string (format: uuid)</td>
    <td>Yes</td>
    <td>UUID for this relationship.</td>
  </tr>
  <tr>
    <td>label</td>
    <td>string</td>
    <td>Yes</td>
    <td>The type of relationship, e.g. &#x27;modifies&#x27;.</td>
  </tr>
  <tr>
    <td>source</td>
    <td>string (format: uuid)</td>
    <td>Yes</td>
    <td>UUID of the source action or asset.</td>
  </tr>
  <tr>
    <td>destination</td>
    <td>string (format: uuid)</td>
    <td>Yes</td>
    <td>UUID of the destination action or asset.</td>
  </tr>
</table>

<!--/JSON_SCHEMA-->

## Example Attack Flow
NOTE: Serialization format TBD. Could be JSON, YAML, CSV, or something else.

<img src="/data/action-object-tesla.png" width="528px">

*Visualization of Tesla breach*

```
type: attack-flow
id: attack-flow--00
name: 'Tesla Breach Flow'
version: 1.0
created: 2021-09-29
modified: 2021-09-29
author: Center for Threat-Informed Defense (CTID)
description: Attack Flow for Tesla Breach (2018)
tags:
  - AWS
  - Cloud
  - Containers
  - Kubernetes
  - S3
start-action-id:
  - action--00
comments: >-
  A quick draft using Version 0.2 of the Actions/Objects Model and the Tesla breach described in
  https://www.zdnet.com/article/tesla-systems-used-by-hackers-to-mine-cryptocurrency/
sightings:
  - type: report
    id: report--00
    name: 'Tesla cloud systems exploited by hackers to mine cryptocurrency'
    report_type: campaign
    published: 2018-02-20
    description: >-
      Updated: Researchers have discovered that Tesla's AWS cloud systems were compromised for the
      purpose of cryptojacking.
    external_references: 'https://www.zdnet.com/article/tesla-systems-used-by-hackers-to-mine-cryptocurrency/'
actions:
  - type: action
    id: action--00
    name: 'External Remote Services'
    description: >-
      Adversary accesses unsecured Kubernetes dashboard, gaining administrative console access
    external_references:
      - external_id: T1133
        source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1133
    x-attack-flow-relative-time: 00:00.000Z
    requirements:
      - object--00
      - object--01
    outputs:
      - object--02
      - object--03
    properties: properties--00
  - type: action
    id: action--01
    name: 'Deploy Container'
    description: >-
      Adversary deploys one/more containers to run cryptomining software
    external_references:
      - external_id: T1610
        source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1610
    x-attack-flow-relative-time: 01:00.000Z
    requirements:
      - object--02
    outputs:
      - object--04
      - object--05
    properties: properties--01
  - type: action
    id: action--02
    name: 'Resource Hijacking'
    description: >-
      Adversary container(s) run cryptomining software using system resources
    external_references:
      - external_id: T1496
        source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1496
    x-attack-flow-relative-time: 02:00.000Z
    requirements:
      - object--04
      - object--05
    outputs:
      - object--06
    properties: properties--02
  - type: action
    id: action--03
    name: 'Unsecured Credentials: Credentials in Files'
    description: >-
      Adversary finds AWS credentials stored in accessible Kubernetes cluster secrets
    external_references:
      - external_id: T1552.001
        source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1552/001
    x-attack-flow-relative-time: 03:00.000Z
    requirements:
      - object--02
      - object--03
    outputs:
      - object--07
    properties: properties--03
  - type: action
    id: action--04
    name: 'Valid Accounts: Cloud Accounts'
    description: >-
      Adversary uses stolen AWS credentials to authenticate to AWS
    external_references:
      - external_id: T1078.004
        source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1078/004
    x-attack-flow-relative-time: 04:00.000Z
    requirements:
      - object--07
    outputs:
      - object--08
    properties: properties--04
  - type: action
    id: action--05
    name: 'Data from Cloud Storage Object'
    description: >-
      Adversary uses AWS access to collect non-public Tesla information from accessible S3
      bucket(s)
    external_references:
      - external_id: T1530
        source_name: mitre-attack
        url: https://attack.mitre.org/techniques/T1530
    x-attack-flow-relative-time: 05:00.000Z
    requirements:
      - object--08
    outputs:
      - object--09
    properties: properties--05
objects:
  - type: object
    id: object--00
    properties:
  - type: object
    id: object--01
    properties:
  - type: object
    id: object--02
    properties:
  - type: object
    id: object--03
    properties:
  - type: object
    id: object--04
    properties:
  - type: object
    id: object--05
    properties:
  - type: object
    id: object--06
    properties:
  - type: object
    id: object--07
    properties:
  - type: object
    id: object--08
    properties:
  - type: object
    id: object--09
    properties:
```
